<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Eikon</title>

  <!-- We will attach CSS dynamically (with cache-busting) -->
</head>
<body>
  <div id="eikon-root"></div>

  <noscript style="font-family:system-ui,Arial,sans-serif;padding:16px;display:block;">
    Eikon requires JavaScript enabled.
  </noscript>

  <script>
    (function () {
      "use strict";

      function log() {
        try { console.log.apply(console, arguments); } catch (e) {}
      }
      function warn() {
        try { console.warn.apply(console, arguments); } catch (e) {}
      }

      var url = new URL(window.location.href);
      var dbg = url.searchParams.get("dbg") || "";
      var v = url.searchParams.get("v") || String(Date.now());

      function withParams(path) {
        var qs = new URLSearchParams();
        qs.set("v", v);
        if (dbg) qs.set("dbg", dbg);
        return path + "?" + qs.toString();
      }

      function loadCss(href) {
        return new Promise(function (resolve, reject) {
          var link = document.createElement("link");
          link.rel = "stylesheet";
          link.href = href;
          link.onload = function () {
            log("[EIKON][boot] CSS loaded:", href);
            resolve();
          };
          link.onerror = function (e) {
            warn("[EIKON][boot] CSS FAILED:", href, e);
            reject(e);
          };
          document.head.appendChild(link);
        });
      }

      function loadScript(src) {
        return new Promise(function (resolve, reject) {
          var s = document.createElement("script");
          s.src = src;
          s.async = false;
          s.defer = false;
          s.onload = function () {
            log("[EIKON][boot] JS loaded:", src);
            resolve();
          };
          s.onerror = function (e) {
            warn("[EIKON][boot] JS FAILED:", src, e);
            reject(e);
          };
          document.head.appendChild(s);
        });
      }

      // Always render something immediately (so black screen never happens silently)
      var root = document.getElementById("eikon-root");
      if (root) {
        root.innerHTML =
          '<div style="font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;padding:18px;">' +
          '<div style="font-size:18px;font-weight:800;margin-bottom:6px;">Eikon</div>' +
          '<div style="opacity:0.75;">Loading UIâ€¦</div>' +
          '</div>';
      }

      // Load in strict order
      loadCss(withParams("./app.css"))
        .then(function () { return loadScript(withParams("./core.js")); })
		.then(function () { return loadScript(withParams("modules.endofday.js")); })
        .then(function () { return loadScript(withParams("./modules.temperature.js")); })
        .then(function () { return loadScript(withParams("./modules.cleaning.js")); })
        .then(function () { return loadScript(withParams("./modules.certificates.js")); })
		.then(function () { return loadScript(withParams("./modules.dailyregister.js")); })
		.then(function () { return loadScript(withParams("./modules.repeatprescriptions.js")); })
		.then(function () { return loadScript(withParams("./modules.ddasales.js")); })
		.then(function () { return loadScript(withParams("./modules.ddapoyc.js")); })
		.then(function () { return loadScript(withParams("./modules.ddapurchases.js")); })
		.then(function () { return loadScript(withParams("./modules.ddastocktakes.js")); })
		.then(function () { return loadScript(withParams("./modules.locumregister.js")); })
		  
        .then(function () { return loadScript(withParams("./main.js")); })
        .then(function () {
          log("[EIKON][boot] All assets loaded.");
        })
        .catch(function (e) {
          warn("[EIKON][boot] Boot failed:", e);
          if (root) {
            root.innerHTML =
              '<div style="font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;padding:18px;">' +
              '<div style="font-size:18px;font-weight:800;margin-bottom:6px;color:#b00020;">Eikon failed to load</div>' +
              '<div style="white-space:pre-wrap;background:#fff;border:1px solid #ddd;padding:12px;border-radius:10px;">' +
              String(e && (e.stack || e.message || e)) +
              "</div></div>";
          }
        });
    })();
  </script>
</body>
</html>
